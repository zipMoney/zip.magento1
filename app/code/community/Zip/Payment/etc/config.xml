<?xml version="1.0"?>
<config>

    <modules>
        <Zip_Payment>
            <version>2.2.2</version>
        </Zip_Payment>
    </modules>

    <global>
        <models>
            <zip_payment>
                <class>Zip_Payment_Model</class>
            </zip_payment>
        </models>
        <blocks>
            <zip_payment>
                <class>Zip_Payment_Block</class>
            </zip_payment>
        </blocks>
        <helpers>
            <zip_payment>
                <class>Zip_Payment_Helper</class>
            </zip_payment>
        </helpers>
        <resources>
            <zip_payment_setup>
                <setup>
                    <module>Zip_Payment</module>
                </setup>
                <connection>
                    <use>core_setup</use>
                </connection>
            </zip_payment_setup>
        </resources>
        <events>
            <controller_action_predispatch>
                <observers>
                    <zip_payment_controller_predispath>
                        <class>zip_payment/observer</class>
                        <method>processControllerPreDispatch</method>
                    </zip_payment_controller_predispath>
                </observers>
            </controller_action_predispatch>
            <controller_action_postdispatch_checkout_onepage_savepayment>
                <observers>
                    <zip_payment_checkout_onepage_savepayment>
                        <class>zip_payment/observer</class>
                        <method>setResponseAfterSavePayment</method>
                    </zip_payment_checkout_onepage_savepayment>
                </observers>
            </controller_action_postdispatch_checkout_onepage_savepayment>
            <controller_action_layout_load_before>
                <observers>
                    <set_checkout_layout_handle>
                        <class>zip_payment/observer</class>
                        <method>setCheckoutLayoutHandle</method>
                    </set_checkout_layout_handle>
                </observers>
            </controller_action_layout_load_before>
        </events>
    </global>

    <frontend>
        <secure_url>
            <zip_payment_checkout>/zip_payment/checkout</zip_payment_checkout>
        </secure_url>
        <routers>
            <zip_payment>
                <use>standard</use>
                <args>
                    <module>Zip_Payment</module>
                    <frontName>zip_payment</frontName>
                </args>
            </zip_payment>
        </routers>
        <translate>
            <modules>
                <Zip_Payment>
                    <files>
                        <default>Zip_Payment.csv</default>
                    </files>
                </Zip_Payment>
            </modules>
        </translate>
        <layout>
            <updates>
                <zip_payment>
                    <file>zip/payment.xml</file>
                </zip_payment>
            </updates>
        </layout>
    </frontend>
    <admin>
        <routers>
            <zip_payment>
                <use>admin</use>
                <args>
                    <module>Zip_Payment</module>
                    <frontName>zip</frontName>
                </args>
            </zip_payment>
        </routers>
    </admin>
    <adminhtml>
        <translate>
            <modules>
                <Zip_Payment>
                    <files>
                        <default>Zip_Payment.csv</default>
                    </files>
                </Zip_Payment>
            </modules>
        </translate>
        <events>
            <controller_action_predispatch_adminhtml>
                <observers>
                    <zip_payment_notification>
                        <class>zip_payment/adminhtml_observer</class>
                        <method>checkAdminNotifications</method>
                    </zip_payment_notification>
                </observers>
            </controller_action_predispatch_adminhtml>
            <adminhtml_init_system_config>
                <observers>
                    <zip_payment_system_config_load>
                        <class>zip_payment/adminhtml_observer</class>
                        <method>loadConfig</method>
                    </zip_payment_system_config_load>
                </observers>
            </adminhtml_init_system_config>
        </events>
    </adminhtml>

    <default>
        <payment>
            <zipmoneypayment>
                <model>zip_payment/legacyMethod</model>
            </zipmoneypayment>
            <zip_payment>
                <active>0</active>
                <title>Zip now, pay later</title>
                <model>zip_payment/method</model>
                <environment>sandbox</environment>
                <region>au</region>
                <payment_action>authorize_capture</payment_action>
                <order_status>processing</order_status>
                <sort_order>1</sort_order>
                <checkout>
                    <type>one_page</type>
                    <path>/checkout/onepage</path>
                    <display_mode>redirect</display_mode>
                    <referred>
                        <order_creation>1</order_creation>
                        <order_status>pending</order_status>
                    </referred>
                </checkout>
                <country_currency>
                    <allow_specific_countries>1</allow_specific_countries>
                    <specific_countries>AU</specific_countries>
                    <allowed_currencies>AUD</allowed_currencies>
                </country_currency>
                <debug>
                    <enabled>1</enabled>
                    <log_level>6</log_level>
                    <log_file>zip_payment.log</log_file>
                </debug>
                <admin_notification>
                    <enabled>1</enabled>
                </admin_notification>
                <widgets>
                    <display_widget_mode>iframe</display_widget_mode>
                    <debug>0</debug>
                    <home_page>
                        <banner>
                            <enabled>1</enabled>
                            <selector>#header-nav</selector>
                        </banner>
                    </home_page>
                    <product_page>
                        <banner>
                            <enabled>0</enabled>
                            <selector>#header-nav</selector>
                        </banner>
                        <tagline>
                            <enabled>0</enabled>
                            <selector>.product-shop .product-options-bottom</selector>
                        </tagline>
                        <widget>
                            <enabled>1</enabled>
                            <selector>.product-shop .extra-info</selector>
                        </widget>
                    </product_page>
                    <category_page>
                        <banner>
                            <enabled>1</enabled>
                            <selector>#header-nav</selector>
                        </banner>
                    </category_page>
                    <cart_page>
                        <banner>
                            <enabled>0</enabled>
                            <selector>#header-nav</selector>
                        </banner>
                        <tagline>
                            <enabled>0</enabled>
                            <selector>.checkout-types.bottom</selector>
                        </tagline>
                        <widget>
                            <enabled>1</enabled>
                            <selector>.checkout-types.bottom</selector>
                        </widget>
                    </cart_page>
                    <checkout_page>
                        <banner>
                            <enabled>1</enabled>
                            <selector>#header-nav</selector>
                        </banner>
                    </checkout_page>
                </widgets>
            </zip_payment>
        </payment>
    </default>

    <custom>
        <payment>
            <zip_payment>
                <logo>https://zip.co/assets/zip/logos/zip/primary.svg</logo>
                <portal>
                    <sandbox>https://merchant.sandbox.zipmoney.com.au/</sandbox>
                    <production>https://merchant.zipmoney.com.au/</production>
                </portal>
                <checkout>
                    <js_lib>https://static.zipmoney.com.au/checkout/checkout-v1.min.js</js_lib>
                    <error>
                        <general>Something went wrong. Please try to checkout out again</general>
                    </error>
                    <failure>
                        <heading>Something went wrong. Please try to checkout out again</heading>
                        <content>
                            <![CDATA[Please contact the merchant or visit <a href='https://help.zipmoney.com.au/hc/en-us/requests/new' target='_blank'>Zip Help Center</a> for any enquiries]]>
                        </content>
                    </failure>
                    <referred>
                        <heading>Order Placed Successfully</heading>
                        <content>
                            <![CDATA[<p>Congratulations! You have successfully placed your order, pending approval of your Zip Money application.</p><p>You will receive an email with instructions shortly on whether your application has been approved or not. If approved you will be able to complete your purchase following the link in the email.</p>]]>
                        </content>
                    </referred>
                </checkout>
                <country_currency>
                    <supported_currencies>AUD,NZD,GBP,USD,ZAR</supported_currencies>
                </country_currency>
                <api>
                    <timeout>0</timeout>
                    <tokenisation>0</tokenisation>
                </api>
                <debug>
                    <log_private_data_keys>ACCT,EXPDATE,CVV2,CARDISSUE,CARDSTART,CREDITCARDTYPE,USER,PWD,SIGNATURE</log_private_data_keys>
                </debug>
                <admin_notification>
                    <feed_url>https://zip-labs-assets.s3-ap-southeast-2.amazonaws.com/plugin/magento1/notification.json</feed_url>
                </admin_notification>
                <widgets>
                    <enabled>1</enabled>
                    <js_lib>https://static.zipmoney.com.au/lib/js/zm-widget-js/dist/zip-widget-js.min.js</js_lib>
                </widgets>
            </zip_payment>
        </payment>
    </custom>
</config>